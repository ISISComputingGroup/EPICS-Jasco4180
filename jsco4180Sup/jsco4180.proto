InTerminator = CR;
OutTerminator = CR LF;

trouble_states = "{TROUBLE OVER PRESS=1|TROUBLE UNDER PRESS=2|TROUBLE EXT STOP=4|PUMP STOP TIMER OFF=8|=0}";

mismatch_catcher {
    in "\%\%[" "%*#" $trouble_states "]\%\%";
}

setFlowrate {
    out "%.3f flowrate set";
    @mismatch { mismatch_catcher; }
}

getFlowrate {
    out "a_flow load p";
    in "%f";
    @mismatch { mismatch_catcher; }
}

getPressure {
    out "a_press1 load p";
    in "%d";
    @mismatch { mismatch_catcher; }
}

setPressureMax {
    out "%d pmax set";
    @mismatch { mismatch_catcher; }
}

getPressureMax {
    out "a_pmax load p";
    in "%d";
    @mismatch { mismatch_catcher; }
}

setPressureMin {
    out "%d pmin set";
    @mismatch { mismatch_catcher; }
}

getPressureMin {
    out "a_pmin load p";
    in "%d";
    @mismatch { mismatch_catcher; }
}

readErrorString {
    in "\%\%%[^%]\%\%";
    @mismatch { mismatch_catcher; }
}

setPump {
    out "%d pump set";
    @mismatch { mismatch_catcher; }
}

getTime {
    out "current_time load p";
    in "%d";
    @mismatch { mismatch_catcher; }
}

getCompA {
    out "compa load p";
    in "%f";
    @mismatch { mismatch_catcher; }
}

getCompB {
    out "compb load p";
    in "%f";
    @mismatch { mismatch_catcher; }
}

getCompC {
    out "compc load p";
    in "%f";
    @mismatch { mismatch_catcher; }
}

getCompD {
    out "compd load p";
    in "%f";
    @mismatch { mismatch_catcher; }
}

setComp {
    out "1 pump set";
    out "0 fileno set";
    out "0 openfile";
    out "%(\$1\$2).1f %(\$1\$3).1f %(\$1\$4).1f %(\$1\$5).1f comp set";
    out "closefile";
    @mismatch { mismatch_catcher; }
}

getError {
    out "trouble load p";
    in "%d";
    @mismatch { mismatch_catcher; }
}

setError {
    out "0 trouble set";
    @mismatch { mismatch_catcher; }
}

reset {
    out "8 pump set";
    wait 150;
    out "1 pump set";
    @mismatch { mismatch_catcher; }
}